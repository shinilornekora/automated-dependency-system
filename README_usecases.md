# Тесткейсы

### 1. Проверка работы команды ads check

**Тест-кейс:**  
**Название:** Все ADS-проверки выполняются (cve-scan, clean, lock)  
**Шаги:**  
- Имитировать проект с валидным package.json и зависимостями  
- Выполнить:  
  

  ads check
  
  
- Убедиться в запуске CVE-сканирования, блокировке неразрешённых изменений, обновлении lock-файла  
- Если найдены CVE — выводится предупреждение  
- Если lock-файл изменён вручную/невалиден — операция завершается ошибкой  
  
**Ожидается:**  
- В консоли отражаются все проведённые проверки  
- Возврат кода 0, если всё ок, или 1 с ошибкой, если найдены проблемы

---

## 2. Установка зависимостей: ads install

**Тест-кейс:**  
**Название:** Разрешена только установка из package.json  
**Шаги:**
- Положить заведомо отличный от lock-файла package.json
- Выполнить


ads install


- Убедиться, что ADS не допустит ручного указания пакетов или вариантов типа npm install foo
- Убедиться, что NPM запускается только с package.json

**Ожидается:**
- Зависимости установлены только из описания package.json
- Нет возможности инъецировать сторонние пакеты

---

## 3. Сборка: ads build

**Тест-кейс:**  
**Название:** Запуск npm run build через ADS  
**Шаги:**
- В package.json должен быть скрипт build
- Выполнить


ads build


- Проследить, что ADS вызывает npm run build

**Ожидается:**
- Скрипт сборки выполнен
- Если скрипта нет — корректное сообщение об ошибке

---

## 4. Чистая установка: ads clean-install

**Тест-кейс:**  
**Название:** Команда позволяет установить зависимости через npm ci  
**Шаги:**
- При наличии и отсутствии файла package-lock.json
- Выполнить


ads clean-install


- Убедиться, что при отсутствии lock-файла операция невозможна, иначе работает

**Ожидается:**
- Возврат ошибки, если нет lock-файла
- Установка, если lock-файл есть

---

## 5. Добавление зависимости: ads add foo 1.2.3

**Тест-кейсы:**

### 5.1 Добавление разрешено только мейнтейнеру

**Шаги:**
- Запустить


ads add lodash 4.17.21


при ADS_MAINTAINER=ivan
- Изменить залогиненного пользователя (не совпадает с мейнтейнером vars)
- Выполнить ту же команду

**Ожидается:**
- Для maintainer'а добавит зависимость
- Для не-maintainer'а — ошибка "нет прав"

### 5.2 Запрет добавления уже существующей

**Шаги:**
- В package.json уже есть lodash
- Выполнить


ads add lodash 4.17.21



**Ожидается:**
- Корректное сообщение: "уже установлено" или отказ

---

## 6. Удаление зависимости: ads remove foo

**Тест-кейсы:**

### 6.1 Только мейнтейнер может удалять

**Шаги:**
- Для maintainer'а:


ads remove lodash


- Для не-maintainer'а:


ads remove lodash



**Ожидается:**
- Только maintainer может удалить зависимости

### 6.2 Удаление несуществующей зависимости

**Шаги:**
- Попробовать удалить заведомо неустановленный пакет

**Ожидается:**
- Получить ошибку “нет такой зависимости”

---

## 7. Разрешённые версии: ads allowed-versions foo

**Тест-кейс:**  
**Название:** Показывает три последних версии пакета  
**Шаги:**
- Выполнить


ads allowed-versions lodash


- Проверить вывод и его обработку при обрыве сети/API NPM

**Ожидается:**
- Выводятся ровно 3 последние версии
- При ошибке — соответствующий вывод

---

## 8. Заглушка для .melignore

**Тест-кейс:**  
**Название:** Зависимости в .melignore не блокируется ADS  
**Шаги:**
- В .melignore написать имя текущего проекта
- Выполнить любую из команд

**Ожидается:**
- Проверки не выполняются, либо выводится сообщение “игнорируется, согласно .melignore”

---

## 9. Проверка работы ENV-переменных

**Тест-кейс:**  
**Шаги:**
- Запустить CLI с и без переменной ADS_MAINTAINER

**Ожидается:**
- Если нет ADS_MAINTAINER — выдаётся предупреждение или используется дефолт
- Если есть — права работают

---

## 10. Использование ADS как библиотеки (программно)

Тест-кейс:
- Импортировать модуль через ES/require (оба способа)
- Вызвать dependencyService.runADSChecks()
- Проверить, что возвращается промис, который выполняет проверки
- Прокинуть разные пользователи и проверить разную реакцию системы (разные права)

---

## 11. Безопасность

Тест-кейсы:
- Запрет попытки установить "левую" зависимость через args типа ads install express
- Блокировка изменения package-lock вручную (попробовать подменить lock-файл — команда должна детектить и ругаться)
- CVE-скан отрабатывает по всем зависимостям

---

## 12. Структура возврата ошибок/логирование

Тест-кейс:
- Корректно ли выводятся ошибки/логируется успех
- CLI возвращает exit code 1 при ошибке

---

## 13. Corner cases

- Пустой project
- Неверный package.json
- Отсутствует npm (как реагирует на npm missing)
- Попробовать все команды в директории без package.json: должны выскакивать адекватные сообщения

---

### Оформление (пример):


### TC-01: Проверка команды `ads check`

- **Setup:** project с валидным package.json, известная зависимость с CVE.
- **Shаги:**
    1. Запусти `ads check`.
- **Ожидание:**
    - Появляется сообщение о найденной CVE.
    - Процесс завершается с ошибкой.
    - Если CVE нет — процесс успешен.


---